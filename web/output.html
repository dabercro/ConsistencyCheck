<!DOCTYPE HTML>
<html lang=en>
  <head>
    <meta http-equiv="refresh" content="1800">
    <link rel="stylesheet" type="text/css" href="stylin.css"/>
  </head>
  <body>

    <div style="background-color:#ccffff;padding-top:1em;margin:0em;">
      <center>
        <h1 style="margin:0em;padding:1em;">Consistency Check Summary</h1>

        <a href="?sites=good"><span class="topbutton">Debugged sites</span></a>
        <a href="?sites=need_checked"><span class="topbutton">Sites that need debugged or hand checking</span></a>
        <a href="?sites=all"><span class="topbutton">All sites</span></a>
      </center>
    </div>

    <div style="padding-top:1em;clear:both;">
      <table border="1" cellpadding="5" align="center">
        <tr>
          <th>
            Last Update
          </th>
          <th>
            Site Name
          </th>
          <th>
            Time [min]
          </th>
          <th>
            Number Files
          </th>
          <th>
            Number Nodes
          </th>
          <th>
            Empty Nodes
          </th>
          <th>
            Num Missing
          </th>
          <th>
            No Source
          </th>
          <th>
            Size [TB]
          </th>
          <th>
            Num Orphan
          </th>
          <th>
            Size [TB]
          </th>
        </tr>
<?php
         while ($row = $results->fetchArray()) {
           $bad_background = ' style="background-color:#ef6f6f;"';
           $background_missing = ($row['missing'] > 100) ? $bad_background : '';
           $background_nosource = ($row['nosource'] > $row['files']/10) ? $bad_background : '';
           $background_orphan = ($row['orphan'] > $row['files']/10) ? $bad_background : '';
           $background_files = ($row['files'] == 0) ? $bad_background : '';
           printf (
             '<tr><td>%s</td><td%s>%s</td><td>%.0f</td><td%s>%d</td><td>%d</td><td>%d</td><td%s><a href="%s_compare_missing.txt">%d</a> [<a href="%s_missing_datasets.txt">blocks</a>]</td><td%s><a href="%s_missing_nosite.txt">%d</a></td><td>%.2f</td><td%s><a href="%s_compare_orphan.txt">%d</a></td><td>%.2f</td></tr>',
             $row['entered'], $background_files, $row['site'], $row['time']/60.,
             $background_files, $row['files'], $row['nodes'], $row['emtpy'],
             $background_missing, $row['site'], $row['missing'], $row['site'],
             $background_nosource, $row['site'], $row['nosource'], $row['m_size']/pow(1024.,4),
             $background_orphan, $row['site'], $row['orphan'], $row['o_size']/pow(1024.,4));
           printf("\n");
         }
?>
      </table>
    </div>

    <h2>Documentation</h2>

    <p>
      Explanations of columns are given <a href="explanations.html">here</a>.
    </p>

    <p>
      Details of the Consistency Check implementation can be seen
      <a href="http://cms-comp-ops-tools.readthedocs.io/en/latest/consistencycheck.html" target="_blank">here</a>.
    </p>

  </body>
</html>
